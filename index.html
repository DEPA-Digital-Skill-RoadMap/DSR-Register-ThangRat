<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ Digital Skill Roadmap</title>
  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://czp.dga.or.th/cportal/sdk/css/v1/trunks.min.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="./index.css">

  <style>
    body { font-family: "Segoe UI", sans-serif; }
    select { width: 100%; margin: 8px 0; padding: 8px; }
    .hidden { display: none; }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="topnav">
    <img src="./image/Logo_Digital_Skill_Roadmap_288x288px_BG-removebg-preview.png" alt="dsr" width="128" height="128">
  </div>

  <!-- Main Form -->
  <div class="box">
    <section class="section">
      <p style="font-size: large; font-weight: bold;">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ Digital Skill Roadmap
      </p>
      <br><br>

      <!-- Personal Info -->
      <fieldset disabled>
        <div class="field">
          <label class="label">IDCARD</label>
          <input id="idcard" class="input" type="text" placeholder="1103703753822">
        </div>

        <div class="field">
          <label class="label">‡∏ä‡∏∑‡πà‡∏≠ (First name)</label>
          <input id="name" class="input" type="text" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢">
        </div>

        <div class="field">
          <label class="label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (Last name)</label>
          <input id="surname" class="input" type="text" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢">
        </div>

        <div class="field">
          <label class="label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
          <input id="email" class="input" type="email" placeholder="e.g. alexsmith@gmail.com">
        </div>

        <div class="field">
          <label class="label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
          <input id="Numphone" class="input" type="text" placeholder="08x-xxx-xxxx">
        </div>

        <div class="field">
          <label class="label">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</label>
          <input id="Birth" class="input" type="text" placeholder="20xx-xx-xx">
        </div>
      </fieldset>

      <br>

      <!-- Course Selections -->
      <div>
        <label>‡∏Å‡∏•‡∏∏‡πà‡∏°</label>
        <select id="group"></select>
      </div>

      <div>
        <label>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏¢‡πà‡∏≠‡∏¢</label>
        <select id="semigroup"></select>
      </div>

      <div>
        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</label>
        <select id="level"></select>
      </div>

      <div>
        <label>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</label>
        <select id="coursegroup"></select>
      </div>

      <div>
        <label>‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</label>
        <select id="course"></select>
      </div>

      <!-- Upload Instructions -->
      <div class="box">
        <div>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å Google Drive</div>
        <img src="./image/97e34777-4abd-4bb6-8be6-a42dc9a0d42a.png" alt="How to get link">
        <p>
          *‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ï‡πâ<br>
          <a href="https://short.depa.or.th/a2Hqv" target="_blank">Click Here</a>
        </p>
      </div>

      <!-- Upload Fields -->
      <div class="field">
        <label class="label">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (Google Drive)</label>
        <input id="IDCardlink" class="input" type="text" placeholder="drive link">
      </div>

      <div class="box">
        <p class="otherdoc">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£...</p>
      </div>

      <div class="field">
        <label class="label">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (Google Drive)</label>
        <input id="Otherdoclink" class="input" type="text" placeholder="drive link">
      </div>

      <!-- Submit -->
      <div style="margin-top: 20px;">
        <button id="submitBtn" class="button is-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>
    </section>
  </div>

  <!-- Loading Page -->
  <div id="loadingPage" class="hidden">
    <div class="screen-center">
      <div class="screen-loader">
        <div></div><div></div><div></div><div></div>
      </div>
      <br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
    </div>
  </div>

  <!-- Success Page -->
  <div id="successPage" class="hidden">
    <div class="screen-center">
      ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß<br>
      ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•<br>
      ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Junk Mail ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ<br>
      ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà
      <a href="https://www.facebook.com/depathai" target="_blank">Facebook DEPATHAI</a>
      <br><br>
      <button id="backBtn">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
  </div>

  <!-- Script -->
  <script>
    let BaseURL = "http://localhost:3000/api";
    let CONFIG = "";
    let Authen_Token = "";
    init();

    // üîπ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
    async function init() {
      try {
        // ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CONFIG
        const res = await fetch("./IPCONFIG.json");
        const data = await res.json();

        BaseURL = data.IsMaintanence === false ? "/api" : "http://localhost:3000/api";
        console.log("Maintenance:", data.IsMaintanence);
        console.log("BaseURL:", BaseURL);

        CONFIG = data;
        loadGroups();

        // üîπ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô LoadThangRatData() ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á CONFIG ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß
        await Verify_AuthenicationToken(CONFIG);

      } catch (err) {
        console.error("Error:", err);
      }
    }
    // get Authorization Token
    async function Verify_AuthenicationToken(CONFIG) {
      const res = await fetch(
        `https://api.egov.go.th/ws/auth/validate?ConsumerSecret=${CONFIG.ConsumerSecret}&AgentID=${CONFIG.AgentID}`,
        {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            "Consumer-Key": CONFIG.ConsumerKey,
          },
        }
      );

      const data = await res.json();
      Authen_Token = data.Result;
      console.log("Authen Token:", Authen_Token);
      getting_M_Token(CONFIG,Authen_Token);
    }
    // Get MToken
    async function getting_M_Token(CONFIG,Authen_Token){
      const res = await fetch(`${CONFIG.URL}`,
        {
          method: "POST",
          headers:{
            "Consumer-Key": CONFIG.ConsumerKey,
            "Content-Type": "application/json",
            "Token":        Authen_Token
          },
          body: JSON.stringify({
            appId: CONFIG.AppID ,

          })
        }
      )
      const data  = await res.json();
      console.log("Mtoken" , data);
    }
    
    // Load mock personal data
    fetch('https://mocki.io/v1/20ecb20d-6232-4f21-b244-2909e7ea6272')
      .then(res => res.json())
      .then(data => {
        document.getElementById('idcard').value = data.idcard || '';
        document.getElementById('name').value = data.name || '';
        document.getElementById('surname').value = data.surname || '';
        document.getElementById('email').value = data.email || '';
        document.getElementById('Numphone').value = data.Numphone || '';
        document.getElementById('Birth').value = data.Birth || '';
      })
      .catch(err => console.error('Error:', err));

    

    // Dropdown Elements
    const groupSelect = document.getElementById("group");
    const semigroupSelect = document.getElementById("semigroup");
    const levelSelect = document.getElementById("level");
    const courseGroupSelect = document.getElementById("coursegroup");
    const courseSelect = document.getElementById("course");
    const otherdoc = document.querySelector(".otherdoc");

    // Load initial group list
    async function loadGroups() {
      const res = await fetch(`${BaseURL}/groups`);
      const data = await res.json();
      groupSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Group --</option>`;
      data.forEach(g => groupSelect.innerHTML += `<option value="${g.group}">${g.group}</option>`);
    }

    // Dynamic dropdown handlers
    groupSelect.addEventListener("change", async () => {
      const group = groupSelect.value;
      const res = await fetch(`${BaseURL}/semigroups?group=${encodeURIComponent(group)}`);
      const data = await res.json();
      semigroupSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Semigroup --</option>`;
      data.forEach(s => semigroupSelect.innerHTML += `<option value="${s.semigroup}">${s.semigroup}</option>`);
      levelSelect.innerHTML = courseGroupSelect.innerHTML = courseSelect.innerHTML = "";
    });

    semigroupSelect.addEventListener("change", async () => {
      const res = await fetch(`${BaseURL}/levels?group=${groupSelect.value}&semigroup=${semigroupSelect.value}`);
      const data = await res.json();
      levelSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Level --</option>`;
      data.forEach(l => levelSelect.innerHTML += `<option value="${l.level}">${l.level}</option>`);
      courseGroupSelect.innerHTML = courseSelect.innerHTML = "";
    });

    levelSelect.addEventListener("change", async () => {
      const res = await fetch(`${BaseURL}/coursegroups?group=${groupSelect.value}&semigroup=${semigroupSelect.value}&level=${levelSelect.value}`);
      const data = await res.json();
      courseGroupSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤ --</option>`;
      data.forEach(cg => courseGroupSelect.innerHTML += `<option value="${cg.coursegroup}">${cg.coursegroup}</option>`);
      courseSelect.innerHTML = "";
    });

    courseGroupSelect.addEventListener("change", async () => {
      const res = await fetch(`${BaseURL}/courses?group=${groupSelect.value}&semigroup=${semigroupSelect.value}&level=${levelSelect.value}&coursegroup=${courseGroupSelect.value}`);
      const data = await res.json();
      courseSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ --</option>`;
      data.forEach(c => courseSelect.innerHTML += `<option value="${c.courses}">${c.courses}</option>`);
    });

    courseSelect.addEventListener("change", async () => {
      const res = await fetch(`${BaseURL}/otherdocs?group=${groupSelect.value}&semigroup=${semigroupSelect.value}&level=${levelSelect.value}&coursegroup=${courseGroupSelect.value}&courses=${courseSelect.value}`);
      const data = await res.json();
      otherdoc.textContent = (data.length > 0 && data[0].otherdoc) ? data[0].otherdoc : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• otherdoc";
    });

    // Submit Handler
    document.getElementById("submitBtn").addEventListener("click", async () => {
      const mainContent = document.querySelector(".box");
      const loadingPage = document.getElementById("loadingPage");
      const successPage = document.getElementById("successPage");

      const payload = {
        idcard: idcard.value,
        name: name.value,
        surname: surname.value,
        email: email.value,
        Numphone: Numphone.value,
        Birth: Birth.value,
        IDCardlink: IDCardlink.value,
        Otherdoclink: Otherdoclink.value,
        group: groupSelect.value,
        semigroup: semigroupSelect.value,
        level: levelSelect.value,
        coursegroup: courseGroupSelect.value,
        course: courseSelect.value
      };

      if (!payload.group || !payload.level || !payload.course) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á!");
        return;
      }

      mainContent.style.display = "none";
      loadingPage.classList.remove("hidden");

      try {
        const res = await fetch(`${BaseURL}/saveSelection`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const result = await res.json();

        loadingPage.classList.add("hidden");

        if (result.success) successPage.classList.remove("hidden");
        else {
          alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + result.message);
          mainContent.style.display = "block";
        }
      } catch (err) {
        console.error(err);
        alert("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ");
        loadingPage.classList.add("hidden");
        mainContent.style.display = "block";
      }
    });

    // Back to main
    document.getElementById("backBtn").addEventListener("click", () => {
      document.getElementById("successPage").classList.add("hidden");
      document.querySelector(".box").style.display = "block";
    });
  </script>
</body>
</html>
